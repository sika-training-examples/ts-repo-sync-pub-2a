# Don't edit this file maually
# This file is generated by ./generate-gitlab-ci.yml

image: ondrejsika/ci

stages:
  - build_js
  - build_docker
  - deploy_dev
  - deploy_prod

variables:
  DOCKER_BUILDKIT: '1'

ansible-schulung.de build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ansible-schulung.de/out
    - yarn run static-ansible-schulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-schulung.de/**/*
      - yarn.lock
  artifacts:
    name: ansible-schulung.de
    paths:
      - packages/ansible-schulung.de/out


ansible-schulung.de build docker:
  dependencies:
    - ansible-schulung.de build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ansible-schulung.de/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ansible-schulung.de packages/ansible-schulung.de
    - rm packages/ansible-schulung.de/Dockerfile
    - docker push registry.sikahq.com/www/www/ansible-schulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-schulung.de/**/*
      - yarn.lock

ansible-schulung.de dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-schulung.de&domain=ansible-schulung.de.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-schulung.de/**/*
      - yarn.lock
  environment:
    name: dev ansible-schulung.de
    url: https://ansible-schulung.de.xsika.cz

ansible-schulung.de prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-schulung.de&domain=ansible-schulung.de&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-schulung.de/**/*
      - yarn.lock
  environment:
    name: prod ansible-schulung.de
    url: https://ansible-schulung.de

ansible-skoleni.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ansible-skoleni.cz/out
    - yarn run static-ansible-skoleni.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-skoleni.cz/**/*
      - yarn.lock
  artifacts:
    name: ansible-skoleni.cz
    paths:
      - packages/ansible-skoleni.cz/out


ansible-skoleni.cz build docker:
  dependencies:
    - ansible-skoleni.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ansible-skoleni.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ansible-skoleni.cz packages/ansible-skoleni.cz
    - rm packages/ansible-skoleni.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/ansible-skoleni.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-skoleni.cz/**/*
      - yarn.lock

ansible-skoleni.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-skoleni.cz&domain=ansible-skoleni.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-skoleni.cz/**/*
      - yarn.lock
  environment:
    name: dev ansible-skoleni.cz
    url: https://ansible-skoleni.cz.xsika.cz

ansible-skoleni.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-skoleni.cz&domain=ansible-skoleni.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-skoleni.cz/**/*
      - yarn.lock
  environment:
    name: prod ansible-skoleni.cz
    url: https://ansible-skoleni.cz

archetype-web build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/archetype-web/out
    - yarn run static-archetype-web
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/archetype-web/**/*
      - yarn.lock
  artifacts:
    name: archetype-web
    paths:
      - packages/archetype-web/out


archetype-web build docker:
  dependencies:
    - archetype-web build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/archetype-web/Dockerfile
    - docker build -t registry.sikahq.com/www/www/archetype-web packages/archetype-web
    - rm packages/archetype-web/Dockerfile
    - docker push registry.sikahq.com/www/www/archetype-web
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/archetype-web/**/*
      - yarn.lock

dockerschulung.de build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/dockerschulung.de/out
    - yarn run static-dockerschulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/dockerschulung.de/**/*
      - yarn.lock
  artifacts:
    name: dockerschulung.de
    paths:
      - packages/dockerschulung.de/out


dockerschulung.de build docker:
  dependencies:
    - dockerschulung.de build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/dockerschulung.de/Dockerfile
    - docker build -t registry.sikahq.com/www/www/dockerschulung.de packages/dockerschulung.de
    - rm packages/dockerschulung.de/Dockerfile
    - docker push registry.sikahq.com/www/www/dockerschulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/dockerschulung.de/**/*
      - yarn.lock

dockerschulung.de dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/dockerschulung.de&domain=dockerschulung.de.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/dockerschulung.de/**/*
      - yarn.lock
  environment:
    name: dev dockerschulung.de
    url: https://dockerschulung.de.xsika.cz

dockerschulung.de prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/dockerschulung.de&domain=dockerschulung.de&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/dockerschulung.de/**/*
      - yarn.lock
  environment:
    name: prod dockerschulung.de
    url: https://dockerschulung.de

gitlab-ci.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/gitlab-ci.cz/out
    - yarn run static-gitlab-ci.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-ci.cz/**/*
      - yarn.lock
  artifacts:
    name: gitlab-ci.cz
    paths:
      - packages/gitlab-ci.cz/out


gitlab-ci.cz build docker:
  dependencies:
    - gitlab-ci.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/gitlab-ci.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/gitlab-ci.cz packages/gitlab-ci.cz
    - rm packages/gitlab-ci.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/gitlab-ci.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-ci.cz/**/*
      - yarn.lock

gitlab-ci.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-ci.cz&domain=gitlab-ci.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-ci.cz/**/*
      - yarn.lock
  environment:
    name: dev gitlab-ci.cz
    url: https://gitlab-ci.cz.xsika.cz

gitlab-ci.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-ci.cz&domain=gitlab-ci.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-ci.cz/**/*
      - yarn.lock
  environment:
    name: prod gitlab-ci.cz
    url: https://gitlab-ci.cz

kubernetes-schulung.de build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/kubernetes-schulung.de/out
    - yarn run static-kubernetes-schulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-schulung.de/**/*
      - yarn.lock
  artifacts:
    name: kubernetes-schulung.de
    paths:
      - packages/kubernetes-schulung.de/out


kubernetes-schulung.de build docker:
  dependencies:
    - kubernetes-schulung.de build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/kubernetes-schulung.de/Dockerfile
    - docker build -t registry.sikahq.com/www/www/kubernetes-schulung.de packages/kubernetes-schulung.de
    - rm packages/kubernetes-schulung.de/Dockerfile
    - docker push registry.sikahq.com/www/www/kubernetes-schulung.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-schulung.de/**/*
      - yarn.lock

kubernetes-schulung.de dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-schulung.de&domain=kubernetes-schulung.de.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-schulung.de/**/*
      - yarn.lock
  environment:
    name: dev kubernetes-schulung.de
    url: https://kubernetes-schulung.de.xsika.cz

kubernetes-schulung.de prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-schulung.de&domain=kubernetes-schulung.de&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-schulung.de/**/*
      - yarn.lock
  environment:
    name: prod kubernetes-schulung.de
    url: https://kubernetes-schulung.de

ondrej-sika.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ondrej-sika.cz/out
    - yarn run static-ondrej-sika.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.cz/**/*
      - yarn.lock
  artifacts:
    name: ondrej-sika.cz
    paths:
      - packages/ondrej-sika.cz/out


ondrej-sika.cz build docker:
  dependencies:
    - ondrej-sika.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ondrej-sika.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ondrej-sika.cz packages/ondrej-sika.cz
    - rm packages/ondrej-sika.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/ondrej-sika.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.cz/**/*
      - yarn.lock

ondrej-sika.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ondrej-sika.cz&domain=ondrej-sika.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.cz/**/*
      - yarn.lock
  environment:
    name: dev ondrej-sika.cz
    url: https://ondrej-sika.cz.xsika.cz

ondrej-sika.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ondrej-sika.cz&domain=ondrej-sika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.cz/**/*
      - yarn.lock
  environment:
    name: prod ondrej-sika.cz
    url: https://ondrej-sika.cz

sika-kraml.de build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/sika-kraml.de/out
    - yarn run static-sika-kraml.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/sika-kraml.de/**/*
      - yarn.lock
  artifacts:
    name: sika-kraml.de
    paths:
      - packages/sika-kraml.de/out


sika-kraml.de build docker:
  dependencies:
    - sika-kraml.de build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/sika-kraml.de/Dockerfile
    - docker build -t registry.sikahq.com/www/www/sika-kraml.de packages/sika-kraml.de
    - rm packages/sika-kraml.de/Dockerfile
    - docker push registry.sikahq.com/www/www/sika-kraml.de
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/sika-kraml.de/**/*
      - yarn.lock

skoleni-docker.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skoleni-docker.cz/out
    - yarn run static-skoleni-docker.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-docker.cz/**/*
      - yarn.lock
  artifacts:
    name: skoleni-docker.cz
    paths:
      - packages/skoleni-docker.cz/out


skoleni-docker.cz build docker:
  dependencies:
    - skoleni-docker.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skoleni-docker.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skoleni-docker.cz packages/skoleni-docker.cz
    - rm packages/skoleni-docker.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/skoleni-docker.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-docker.cz/**/*
      - yarn.lock

skoleni-docker.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-docker.cz&domain=skoleni-docker.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-docker.cz/**/*
      - yarn.lock
  environment:
    name: dev skoleni-docker.cz
    url: https://skoleni-docker.cz.xsika.cz

skoleni-docker.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-docker.cz&domain=skoleni-docker.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-docker.cz/**/*
      - yarn.lock
  environment:
    name: prod skoleni-docker.cz
    url: https://skoleni-docker.cz

skoleni-git.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skoleni-git.cz/out
    - yarn run static-skoleni-git.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-git.cz/**/*
      - yarn.lock
  artifacts:
    name: skoleni-git.cz
    paths:
      - packages/skoleni-git.cz/out


skoleni-git.cz build docker:
  dependencies:
    - skoleni-git.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skoleni-git.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skoleni-git.cz packages/skoleni-git.cz
    - rm packages/skoleni-git.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/skoleni-git.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-git.cz/**/*
      - yarn.lock

skoleni-git.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-git.cz&domain=skoleni-git.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-git.cz/**/*
      - yarn.lock
  environment:
    name: dev skoleni-git.cz
    url: https://skoleni-git.cz.xsika.cz

skoleni-git.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-git.cz&domain=skoleni-git.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-git.cz/**/*
      - yarn.lock
  environment:
    name: prod skoleni-git.cz
    url: https://skoleni-git.cz

skoleni-kubernetes.cz build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skoleni-kubernetes.cz/out
    - yarn run static-skoleni-kubernetes.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-kubernetes.cz/**/*
      - yarn.lock
  artifacts:
    name: skoleni-kubernetes.cz
    paths:
      - packages/skoleni-kubernetes.cz/out


skoleni-kubernetes.cz build docker:
  dependencies:
    - skoleni-kubernetes.cz build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skoleni-kubernetes.cz/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skoleni-kubernetes.cz packages/skoleni-kubernetes.cz
    - rm packages/skoleni-kubernetes.cz/Dockerfile
    - docker push registry.sikahq.com/www/www/skoleni-kubernetes.cz
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-kubernetes.cz/**/*
      - yarn.lock

skoleni-kubernetes.cz dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-kubernetes.cz&domain=skoleni-kubernetes.cz.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-kubernetes.cz/**/*
      - yarn.lock
  environment:
    name: dev skoleni-kubernetes.cz
    url: https://skoleni-kubernetes.cz.xsika.cz

skoleni-kubernetes.cz prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skoleni-kubernetes.cz&domain=skoleni-kubernetes.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skoleni-kubernetes.cz/**/*
      - yarn.lock
  environment:
    name: prod skoleni-kubernetes.cz
    url: https://skoleni-kubernetes.cz

git-training.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/git-training.uk/out
    - yarn run static-git-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-training.uk/**/*
      - yarn.lock
  artifacts:
    name: git-training.uk
    paths:
      - packages/git-training.uk/out


git-training.uk build docker:
  dependencies:
    - git-training.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/git-training.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/git-training.uk packages/git-training.uk
    - rm packages/git-training.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/git-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-training.uk/**/*
      - yarn.lock

git-training.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/git-training.uk&domain=git-training.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-training.uk/**/*
      - yarn.lock
  environment:
    name: dev git-training.uk
    url: https://git-training.uk.xsika.cz

git-training.uk prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/git-training.uk&domain=git-training.uk&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-training.uk/**/*
      - yarn.lock
  environment:
    name: prod git-training.uk
    url: https://git-training.uk

docker-training.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/docker-training.uk/out
    - yarn run static-docker-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-training.uk/**/*
      - yarn.lock
  artifacts:
    name: docker-training.uk
    paths:
      - packages/docker-training.uk/out


docker-training.uk build docker:
  dependencies:
    - docker-training.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/docker-training.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/docker-training.uk packages/docker-training.uk
    - rm packages/docker-training.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/docker-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-training.uk/**/*
      - yarn.lock

docker-training.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/docker-training.uk&domain=docker-training.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-training.uk/**/*
      - yarn.lock
  environment:
    name: dev docker-training.uk
    url: https://docker-training.uk.xsika.cz

docker-training.uk prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/docker-training.uk&domain=docker-training.uk&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-training.uk/**/*
      - yarn.lock
  environment:
    name: prod docker-training.uk
    url: https://docker-training.uk

kubernetes-training.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/kubernetes-training.uk/out
    - yarn run static-kubernetes-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-training.uk/**/*
      - yarn.lock
  artifacts:
    name: kubernetes-training.uk
    paths:
      - packages/kubernetes-training.uk/out


kubernetes-training.uk build docker:
  dependencies:
    - kubernetes-training.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/kubernetes-training.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/kubernetes-training.uk packages/kubernetes-training.uk
    - rm packages/kubernetes-training.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/kubernetes-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-training.uk/**/*
      - yarn.lock

kubernetes-training.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-training.uk&domain=kubernetes-training.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-training.uk/**/*
      - yarn.lock
  environment:
    name: dev kubernetes-training.uk
    url: https://kubernetes-training.uk.xsika.cz

kubernetes-training.uk prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-training.uk&domain=kubernetes-training.uk&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-training.uk/**/*
      - yarn.lock
  environment:
    name: prod kubernetes-training.uk
    url: https://kubernetes-training.uk

ansible-training.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ansible-training.uk/out
    - yarn run static-ansible-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-training.uk/**/*
      - yarn.lock
  artifacts:
    name: ansible-training.uk
    paths:
      - packages/ansible-training.uk/out


ansible-training.uk build docker:
  dependencies:
    - ansible-training.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ansible-training.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ansible-training.uk packages/ansible-training.uk
    - rm packages/ansible-training.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/ansible-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-training.uk/**/*
      - yarn.lock

ansible-training.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-training.uk&domain=ansible-training.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-training.uk/**/*
      - yarn.lock
  environment:
    name: dev ansible-training.uk
    url: https://ansible-training.uk.xsika.cz

ansible-training.uk prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-training.uk&domain=ansible-training.uk&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-training.uk/**/*
      - yarn.lock
  environment:
    name: prod ansible-training.uk
    url: https://ansible-training.uk

gitlab-training.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/gitlab-training.uk/out
    - yarn run static-gitlab-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-training.uk/**/*
      - yarn.lock
  artifacts:
    name: gitlab-training.uk
    paths:
      - packages/gitlab-training.uk/out


gitlab-training.uk build docker:
  dependencies:
    - gitlab-training.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/gitlab-training.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/gitlab-training.uk packages/gitlab-training.uk
    - rm packages/gitlab-training.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/gitlab-training.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-training.uk/**/*
      - yarn.lock

gitlab-training.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-training.uk&domain=gitlab-training.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-training.uk/**/*
      - yarn.lock
  environment:
    name: dev gitlab-training.uk
    url: https://gitlab-training.uk.xsika.cz

gitlab-training.uk prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-training.uk&domain=gitlab-training.uk&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-training.uk/**/*
      - yarn.lock
  environment:
    name: prod gitlab-training.uk
    url: https://gitlab-training.uk

skolenie-git.sk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skolenie-git.sk/out
    - yarn run static-skolenie-git.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-git.sk/**/*
      - yarn.lock
  artifacts:
    name: skolenie-git.sk
    paths:
      - packages/skolenie-git.sk/out


skolenie-git.sk build docker:
  dependencies:
    - skolenie-git.sk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skolenie-git.sk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skolenie-git.sk packages/skolenie-git.sk
    - rm packages/skolenie-git.sk/Dockerfile
    - docker push registry.sikahq.com/www/www/skolenie-git.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-git.sk/**/*
      - yarn.lock

skolenie-git.sk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skolenie-git.sk&domain=skolenie-git.sk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-git.sk/**/*
      - yarn.lock
  environment:
    name: dev skolenie-git.sk
    url: https://skolenie-git.sk.xsika.cz

skolenie-gitlab.sk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skolenie-gitlab.sk/out
    - yarn run static-skolenie-gitlab.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-gitlab.sk/**/*
      - yarn.lock
  artifacts:
    name: skolenie-gitlab.sk
    paths:
      - packages/skolenie-gitlab.sk/out


skolenie-gitlab.sk build docker:
  dependencies:
    - skolenie-gitlab.sk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skolenie-gitlab.sk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skolenie-gitlab.sk packages/skolenie-gitlab.sk
    - rm packages/skolenie-gitlab.sk/Dockerfile
    - docker push registry.sikahq.com/www/www/skolenie-gitlab.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-gitlab.sk/**/*
      - yarn.lock

skolenie-gitlab.sk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skolenie-gitlab.sk&domain=skolenie-gitlab.sk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-gitlab.sk/**/*
      - yarn.lock
  environment:
    name: dev skolenie-gitlab.sk
    url: https://skolenie-gitlab.sk.xsika.cz

skolenie-docker.sk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skolenie-docker.sk/out
    - yarn run static-skolenie-docker.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-docker.sk/**/*
      - yarn.lock
  artifacts:
    name: skolenie-docker.sk
    paths:
      - packages/skolenie-docker.sk/out


skolenie-docker.sk build docker:
  dependencies:
    - skolenie-docker.sk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skolenie-docker.sk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skolenie-docker.sk packages/skolenie-docker.sk
    - rm packages/skolenie-docker.sk/Dockerfile
    - docker push registry.sikahq.com/www/www/skolenie-docker.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-docker.sk/**/*
      - yarn.lock

skolenie-docker.sk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skolenie-docker.sk&domain=skolenie-docker.sk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-docker.sk/**/*
      - yarn.lock
  environment:
    name: dev skolenie-docker.sk
    url: https://skolenie-docker.sk.xsika.cz

skolenie.kubernetes.sk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skolenie.kubernetes.sk/out
    - yarn run static-skolenie.kubernetes.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie.kubernetes.sk/**/*
      - yarn.lock
  artifacts:
    name: skolenie.kubernetes.sk
    paths:
      - packages/skolenie.kubernetes.sk/out


skolenie.kubernetes.sk build docker:
  dependencies:
    - skolenie.kubernetes.sk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skolenie.kubernetes.sk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skolenie.kubernetes.sk packages/skolenie.kubernetes.sk
    - rm packages/skolenie.kubernetes.sk/Dockerfile
    - docker push registry.sikahq.com/www/www/skolenie.kubernetes.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie.kubernetes.sk/**/*
      - yarn.lock

skolenie.kubernetes.sk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skolenie.kubernetes.sk&domain=skolenie.kubernetes.sk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie.kubernetes.sk/**/*
      - yarn.lock
  environment:
    name: dev skolenie.kubernetes.sk
    url: https://skolenie.kubernetes.sk.xsika.cz

skolenie-ansible.sk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/skolenie-ansible.sk/out
    - yarn run static-skolenie-ansible.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-ansible.sk/**/*
      - yarn.lock
  artifacts:
    name: skolenie-ansible.sk
    paths:
      - packages/skolenie-ansible.sk/out


skolenie-ansible.sk build docker:
  dependencies:
    - skolenie-ansible.sk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/skolenie-ansible.sk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/skolenie-ansible.sk packages/skolenie-ansible.sk
    - rm packages/skolenie-ansible.sk/Dockerfile
    - docker push registry.sikahq.com/www/www/skolenie-ansible.sk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-ansible.sk/**/*
      - yarn.lock

skolenie-ansible.sk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/skolenie-ansible.sk&domain=skolenie-ansible.sk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/skolenie-ansible.sk/**/*
      - yarn.lock
  environment:
    name: dev skolenie-ansible.sk
    url: https://skolenie-ansible.sk.xsika.cz

ansible-utbildning.se build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ansible-utbildning.se/out
    - yarn run static-ansible-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-utbildning.se/**/*
      - yarn.lock
  artifacts:
    name: ansible-utbildning.se
    paths:
      - packages/ansible-utbildning.se/out


ansible-utbildning.se build docker:
  dependencies:
    - ansible-utbildning.se build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ansible-utbildning.se/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ansible-utbildning.se packages/ansible-utbildning.se
    - rm packages/ansible-utbildning.se/Dockerfile
    - docker push registry.sikahq.com/www/www/ansible-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-utbildning.se/**/*
      - yarn.lock

ansible-utbildning.se dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-utbildning.se&domain=ansible-utbildning.se.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-utbildning.se/**/*
      - yarn.lock
  environment:
    name: dev ansible-utbildning.se
    url: https://ansible-utbildning.se.xsika.cz

ansible-utbildning.se prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ansible-utbildning.se&domain=ansible-utbildning.se&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ansible-utbildning.se/**/*
      - yarn.lock
  environment:
    name: prod ansible-utbildning.se
    url: https://ansible-utbildning.se

docker-utbildning.se build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/docker-utbildning.se/out
    - yarn run static-docker-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-utbildning.se/**/*
      - yarn.lock
  artifacts:
    name: docker-utbildning.se
    paths:
      - packages/docker-utbildning.se/out


docker-utbildning.se build docker:
  dependencies:
    - docker-utbildning.se build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/docker-utbildning.se/Dockerfile
    - docker build -t registry.sikahq.com/www/www/docker-utbildning.se packages/docker-utbildning.se
    - rm packages/docker-utbildning.se/Dockerfile
    - docker push registry.sikahq.com/www/www/docker-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-utbildning.se/**/*
      - yarn.lock

docker-utbildning.se dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/docker-utbildning.se&domain=docker-utbildning.se.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-utbildning.se/**/*
      - yarn.lock
  environment:
    name: dev docker-utbildning.se
    url: https://docker-utbildning.se.xsika.cz

docker-utbildning.se prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/docker-utbildning.se&domain=docker-utbildning.se&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/docker-utbildning.se/**/*
      - yarn.lock
  environment:
    name: prod docker-utbildning.se
    url: https://docker-utbildning.se

git-utbildning.se build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/git-utbildning.se/out
    - yarn run static-git-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-utbildning.se/**/*
      - yarn.lock
  artifacts:
    name: git-utbildning.se
    paths:
      - packages/git-utbildning.se/out


git-utbildning.se build docker:
  dependencies:
    - git-utbildning.se build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/git-utbildning.se/Dockerfile
    - docker build -t registry.sikahq.com/www/www/git-utbildning.se packages/git-utbildning.se
    - rm packages/git-utbildning.se/Dockerfile
    - docker push registry.sikahq.com/www/www/git-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-utbildning.se/**/*
      - yarn.lock

git-utbildning.se dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/git-utbildning.se&domain=git-utbildning.se.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-utbildning.se/**/*
      - yarn.lock
  environment:
    name: dev git-utbildning.se
    url: https://git-utbildning.se.xsika.cz

git-utbildning.se prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/git-utbildning.se&domain=git-utbildning.se&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/git-utbildning.se/**/*
      - yarn.lock
  environment:
    name: prod git-utbildning.se
    url: https://git-utbildning.se

gitlab-utbildning.se build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/gitlab-utbildning.se/out
    - yarn run static-gitlab-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-utbildning.se/**/*
      - yarn.lock
  artifacts:
    name: gitlab-utbildning.se
    paths:
      - packages/gitlab-utbildning.se/out


gitlab-utbildning.se build docker:
  dependencies:
    - gitlab-utbildning.se build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/gitlab-utbildning.se/Dockerfile
    - docker build -t registry.sikahq.com/www/www/gitlab-utbildning.se packages/gitlab-utbildning.se
    - rm packages/gitlab-utbildning.se/Dockerfile
    - docker push registry.sikahq.com/www/www/gitlab-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-utbildning.se/**/*
      - yarn.lock

gitlab-utbildning.se dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-utbildning.se&domain=gitlab-utbildning.se.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-utbildning.se/**/*
      - yarn.lock
  environment:
    name: dev gitlab-utbildning.se
    url: https://gitlab-utbildning.se.xsika.cz

gitlab-utbildning.se prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/gitlab-utbildning.se&domain=gitlab-utbildning.se&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/gitlab-utbildning.se/**/*
      - yarn.lock
  environment:
    name: prod gitlab-utbildning.se
    url: https://gitlab-utbildning.se

kubernetes-utbildning.se build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/kubernetes-utbildning.se/out
    - yarn run static-kubernetes-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-utbildning.se/**/*
      - yarn.lock
  artifacts:
    name: kubernetes-utbildning.se
    paths:
      - packages/kubernetes-utbildning.se/out


kubernetes-utbildning.se build docker:
  dependencies:
    - kubernetes-utbildning.se build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/kubernetes-utbildning.se/Dockerfile
    - docker build -t registry.sikahq.com/www/www/kubernetes-utbildning.se packages/kubernetes-utbildning.se
    - rm packages/kubernetes-utbildning.se/Dockerfile
    - docker push registry.sikahq.com/www/www/kubernetes-utbildning.se
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-utbildning.se/**/*
      - yarn.lock

kubernetes-utbildning.se dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-utbildning.se&domain=kubernetes-utbildning.se.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-utbildning.se/**/*
      - yarn.lock
  environment:
    name: dev kubernetes-utbildning.se
    url: https://kubernetes-utbildning.se.xsika.cz

kubernetes-utbildning.se prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/kubernetes-utbildning.se&domain=kubernetes-utbildning.se&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/kubernetes-utbildning.se/**/*
      - yarn.lock
  environment:
    name: prod kubernetes-utbildning.se
    url: https://kubernetes-utbildning.se

ondrej-sika.uk build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ondrej-sika.uk/out
    - yarn run static-ondrej-sika.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.uk/**/*
      - yarn.lock
  artifacts:
    name: ondrej-sika.uk
    paths:
      - packages/ondrej-sika.uk/out


ondrej-sika.uk build docker:
  dependencies:
    - ondrej-sika.uk build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ondrej-sika.uk/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ondrej-sika.uk packages/ondrej-sika.uk
    - rm packages/ondrej-sika.uk/Dockerfile
    - docker push registry.sikahq.com/www/www/ondrej-sika.uk
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.uk/**/*
      - yarn.lock

ondrej-sika.uk dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ondrej-sika.uk&domain=ondrej-sika.uk.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrej-sika.uk/**/*
      - yarn.lock
  environment:
    name: dev ondrej-sika.uk
    url: https://ondrej-sika.uk.xsika.cz

ondrejsikalabs.com build js:
  stage: build_js
  image: node
  variables:
    GIT_CLEAN_FLAGS: none
  script:
    - yarn
    - rm -rf packages/ondrejsikalabs.com/out
    - yarn run static-ondrejsikalabs.com
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrejsikalabs.com/**/*
      - yarn.lock
  artifacts:
    name: ondrejsikalabs.com
    paths:
      - packages/ondrejsikalabs.com/out


ondrejsikalabs.com build docker:
  dependencies:
    - ondrejsikalabs.com build js
  variables:
    GIT_STRATEGY: none
  stage: build_docker
  script:
    - docker login $CI_REGISTRY -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD
    - cp ci/docker/Dockerfile packages/ondrejsikalabs.com/Dockerfile
    - docker build -t registry.sikahq.com/www/www/ondrejsikalabs.com packages/ondrejsikalabs.com
    - rm packages/ondrejsikalabs.com/Dockerfile
    - docker push registry.sikahq.com/www/www/ondrejsikalabs.com
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrejsikalabs.com/**/*
      - yarn.lock

ondrejsikalabs.com dev deploy:
  stage: deploy_dev
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ondrejsikalabs.com&domain=ondrejsikalabs.com.xsika.cz&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrejsikalabs.com/**/*
      - yarn.lock
  environment:
    name: dev ondrejsikalabs.com
    url: https://ondrejsikalabs.com.xsika.cz

ondrejsikalabs.com prod deploy:
  stage: deploy_prod
  variables:
    GIT_STRATEGY: none
  script:
    - curl -s "$SOD_URL/api/v1/deploy/docker/?image=$CI_REGISTRY_IMAGE/ondrejsikalabs.com&domain=ondrejsikalabs.com&token=$SOD_TOKEN&registry=$CI_REGISTRY&registry_user=$CI_REGISTRY_USER&registry_password=$CI_REGISTRY_PASSWORD"
  only:
    refs:
      - master
    changes:
      - packages/data/**/*
      - packages/common/**/*
      - packages/course-landing/**/*
      - packages/ondrejsikalabs.com/**/*
      - yarn.lock
  environment:
    name: prod ondrejsikalabs.com
    url: https://ondrejsikalabs.com

